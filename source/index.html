<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>I can do it</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@latest/ol.css" />
    <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL"></script>
    <!-- <-- OpenLayers 라이브러리 가져오기 -->
    <script src="https://cdn.jsdelivr.net/npm/ol@latest/dist/ol.js"></script>
    <!-- ol-ext -->
    <script type="text/javascript" src="./dist/ol-ext.js"></script>
    <!-- jQuery -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
  <style>
    /* 지도 컨테이너의 크기 지정 */
    #map {
      width: 100%;
      height: 500px;
    }

    .frame {
        border: 1px solid black; /* 프레임 테두리 스타일 설정 */
        margin: 10px; /* 프레임 외부 여백 설정 */
        width: 200px; /* 프레임 너비 설정 */
        height: 60px; /* 프레임 너비 설정 */
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: flex-start;
    }

    .container {
        display: grid;
        grid-template-columns: 1fr 230px 1fr;
        grid-gap: 10px;
    }
  </style>
</head>
<body>  <!-- onload="loadVectorLayer()" -->
  <div id="map"></div>
  <div><button onclick="getFile()">Open</button></div>
  <div class="options" >
    <h2>Options:</h2>
    <div class="container">
      <ul>
        <li>
          <input id="scale" type="checkbox" onchange="setPropertie(this.id);" checked="checked" /><label for="scale"> enable scale</label>
        </li><li>
          <!-- <input id="stretch" type="checkbox" onchange="setPropertie(this.id);" checked="checked" /><label for="stretch"> enable stretch</label>
        </li><li> --> 
          <!-- stretch와 scale의 차이점을 아직 모르겠어서... -->
          <input id="rotate" type="checkbox" onchange="setPropertie(this.id);" checked="checked" /><label for="rotate"> enable rotate</label>
        </li>
        <li>
          <hr/>
          Use <i>Shift</i> key to preserve proportions when scaling (see keepAspectRatio).
          <br />
          Use <i>Ctrl</i> key to modify the center when scaling.
        </li>
      </ul> 
      <div class="frame" style="background:white; padding:0 0.45em;">
        <div id="scaleinfo">scale: </div>
        <div id="rotateinfo">rotate: </div>
      </div>
    </div>
  </div>

    <!-- <script src="./addTileLayer.js"></script>
    <script src="./addFileFromLocal.js"></script> -->
    <script src="./getLocalFile.js"></script>
    
    <script>
    const layers = [
    new ol.layer.Tile({
      source: new ol.source.OSM(),
    }),
  ];
// The map
    var map = new ol.Map({
      target: 'map',
        view: new ol.View({
          center: ol.proj.fromLonLat([127.1119894,  37.3925837]),
          zoom: 17,
        }),
        layers: layers
      });

    // GeoJSON 파일 로드 및 표시
    const vectorSource = new ol.source.Vector({
      url: "./sample.geojson",
      format: new ol.format.GeoJSON(),
      loader: function (extent, resolution, projection) {
        const url = this.getUrl();
        if (url) {
          fetch(url)
            .then(function (response) {
              return response.json();
            })
            .then(function (json) {
              const format = vectorSource.getFormat();
              const features = format.readFeatures(json, {
                dataProjection: "EPSG:4326", // GeoJSON 데이터의 좌표 체계
                featureProjection: "EPSG:3857", // 맵에 표시할 좌표 체계
              });
              vectorSource.addFeatures(features);
            });
        }
      },
    });

    var vectorLayer = new ol.layer.Vector({
      source: vectorSource,
      style: new ol.style.Style({
        stroke: new ol.style.Stroke({
          color: "rgba(255, 255, 255, 0.7)",
          width: 2,
        }),
        fill: new ol.style.Fill({
          color: "#718AE3",
        }),
      }),
    });

    map.addLayer(vectorLayer);

    // Set cursor style
    ol.interaction.Transform.prototype.Cursors['rotate'] = 'url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAAAXNSR0IArs4c6QAAAeBJREFUSEvdlbFLW1EUh7/zQlJMGhd1sRpIyaBT/wgXh0IpaN26u1sK3Tp0aTs6dHcSHUQoTi7iJIU62SFLIFIXo0SCkaZ5t5zkpd4mN7nXRYoX3vDePe9+5/7O+d0r3MOQe2Dw30Ei4DEwAdSAX4kKN5YaGhP3qxOykyVgyyPrOlAExoH3wL4d74OcAPP6gzHGyRHpLjGef0T96gYR2QVehEDWgE9RFNFut729oaBeEiLyFXjug9wJMKC/yA7w0gfp6OKSp1AQqlWYnYHqaXeZ/rhQuZyQnvZ2hq5EQuUy/T9rbYwx34AF4ApYNMbsuYolIl+AVa9cNiTZge5OPWCPReApcJk8M8A1sG15qBM/0MIiYuL41k8jIN6u6wV4IYVZ0SK/CjDkUKgX8mQ64ueZ2QBeO1ZZBjYtRZzJuBw/UPhEsrfARwv0DDjW91Qq1TFtYsrBxB3ZmVKpRLlc/mdqcjJNrfa79+0d8GF+bkxOfmitu0NhcRxPAee+7qrrUTTsrBpV7UwmQ6vVSgN/s3F2F6AyfFed7wIqFieoVC5crT700lLQod4foaCkbsGFtxVR2FEul8s0Gg2nUtlslmazqXNvgM/OUyDQUQo7APJ9BlZ5Vnwe8l1agTmMDns4kD/NNpkafvid6QAAAABJRU5ErkJggg==\') 5 5, auto';
    ol.interaction.Transform.prototype.Cursors['rotate0'] = 'url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAAAXNSR0IArs4c6QAAAu9JREFUSEvdld1L01Ecxj/nNzd1uZWWDEulGbIsV0YQQRdBEXVVROALXURmV0VQVgRddhGWhZBELxeVFEVvf0CUhFIURJQvvVGouQzb1GnUtLlz4uRmS2f7BSHRuTv8nvN9zvN8n+/5CaZhiWng4J8j0ReyAXbgKxCJujAa54bGqInumFGyBFgPLEtLS9uSmZlpkVJKv9/fJ6W8CbwC+oFcwAE0AG/jiZKRlAPnvN5ix4OmNmREMDxsxW6XIEYJBmH1Grfq6OgQTkcqTfdHKFlONXDSLInTMIxg6zMlFhVNcuAXR4QVVBh8HyBvPgeB42ZIlhmG8ejMaZtt545h0wEMhcDuZC9QZ4bkTXuLKIxXcK9RsL1KMdMJg4MgpQVfV6z3YyUDAcjOMWdXiddb3NjytC0zdpv2F7kUL/Xp7RdglW7w1Ssrm8tLH/8Spm4f5LvN2bVnaIA6R8bYDGkF6zZwRynVChwGRgBPbQ2thYVY7XZITYWBIKMjw6jSCiqBy8nsqh7wUztr1hgsvwC6u0mLFo8/6wGyo+r03Gjl34DncTP0Az8pwoZhHOp8J4/m6dQD3hJkWzsW091PAExEsr+vVx4fV+JGdfsw/jbJvmCfPOHIGCs7L1/Q81GVAjemINIq1wIhoDkRJtHEH3jfwbGYXZ8/L8aZ1a6zmg/0JCgStlgsKZFIRAkh3iul5pt5u+Z5PJ6WV22vs2LgI0fLqK+//frTp3AFEAYGgfqihekbc3JGuXU9jLbXkmr0Synzog/oONdUb1dZVaVx7fxZOQ70+53cbRxCT3V6OhiGYPOm2dhsgXGMzW4NhcNhbfTPg4nSFSd1xe5dMx6fqtPzl3y5C7Po7OxfBLw0Y1cMo1VWP2wWNQVuq+Fy6RGYvILBFPZWq9DFhogm6DTb+Im4bS6Xa+7Wit5KIcQCq1UIKQ2UUhIiTy5cmnM9EAjo/0rXVHqT/U/iz+moWoH0aFx14vReT/tv15+QJKs15ff/h+Q7KS/zGtdE+2gAAAAASUVORK5CYII=\') 5 5, auto';

    /** Style the transform handles for the current interaction
    */
    function setHandleStyle(){
      if (!interaction instanceof ol.interaction.Transform) return;
      if ($("#style").prop('checked')) {
        // Style the rotate handle
        var circle = new ol.style.RegularShape({
          fill: new ol.style.Fill({color:[255,255,255,0.01]}),
          stroke: new ol.style.Stroke({width:1, color:[0,0,0,0.01]}),
          radius: 8,
          points: 10
        });
        interaction.setStyle ('rotate',
          new ol.style.Style({
            text: new ol.style.Text ({
              text:'\uf0e2', 
              font:"16px Fontawesome",
              textAlign: "left",
              fill:new ol.style.Fill({color:'red'})
            }),
            image: circle
          }));
        // Center of rotation
        interaction.setStyle ('rotate0',
          new ol.style.Style({
            text: new ol.style.Text ({
              text:'\uf0e2', 
              font:"20px Fontawesome",
              fill: new ol.style.Fill({ color:[255,255,255,0.8] }),
              stroke: new ol.style.Stroke({ width:2, color:'red' })
            }),
          }));
        // Style the move handle
        interaction.setStyle('translate',
          new ol.style.Style({
            text: new ol.style.Text ({
              text:'\uf047', 
              font:"20px Fontawesome", 
              fill: new ol.style.Fill({ color:[255,255,255,0.8] }),
              stroke: new ol.style.Stroke({ width:2, color:'red' })
            })
          }));
      } else {
        interaction.setDefaultStyle ();
      }
      // Refresh
      interaction.set('translate', interaction.get('translate'));
    };

    /** Set properties
    */
    function setPropertie (p) {
      interaction.set(p, $("#"+p).prop('checked'));
      if (!$("#scale").prop("checked")) $("#stretch").prop('disabled', true);
      else $("#stretch").prop('disabled', false);
    }

    function setAspectRatio (p) {
      if ($("#"+p).prop('checked')) interaction.set("keepAspectRatio", ol.events.condition.always);
      else interaction.set("keepAspectRatio", function(e){ return e.originalEvent.shiftKey });
    }

    var interaction = new ol.interaction.Transform ({
      enableRotatedTransform: false,
      addCondition: ol.events.condition.shiftKeyOnly,
      hitTolerance: 2,
      translateFeature: $("#translateFeature").prop('checked'),
      scale: $("#scale").prop('checked'),
      rotate: $("#rotate").prop('checked'),
      keepAspectRatio: $("#keepAspectRatio").prop('checked') ? ol.events.condition.always : undefined,
      keepRectangle: false,
      translate: $("#translate").prop('checked'),
      stretch: $("#stretch").prop('checked'),
      // Get scale on points
      pointRadius: function(f) {
        var radius = f.get('radius') || 10;
        return [radius, radius];
      }
    });
    map.addInteraction(interaction);

    // Style handles
    setHandleStyle();
    // Events handlers
    var startangle = 0;
    var startRadius = 10;
    var d=[0,0];

    // Handle rotate on first point
    var firstPoint = false;
    interaction.on (['select'], function(e) {
      if (firstPoint && e.features && e.features.getLength()) {
        interaction.setCenter(e.features.getArray()[0].getGeometry().getFirstCoordinate());
      }
    });

    interaction.on (['rotatestart','translatestart','scalestart'], function(e){
      // Rotation
      startangle = e.feature.get('angle')||0;
      // radius
      startRadius = e.feature.get('radius')||10;
      // // Translation
      // d=[0,0];
    });
    interaction.on('rotating', function (e){
      $('#rotateinfo').text("rotate: "+((e.angle*180/Math.PI -180)%360+180).toFixed(2)); 
      // Set angle attribute to be used on style !
      e.feature.set('angle', startangle - e.angle);
    });
    // interaction.on('translating', function (e){
    //   d[0]+=e.delta[0];
    //   d[1]+=e.delta[1];
    //   $('#info').text("translate: "+d[0].toFixed(2)+","+d[1].toFixed(2)); 
    //   if (firstPoint) {
    //     interaction.setCenter(e.features.getArray()[0].getGeometry().getFirstCoordinate());
    //   }
    // });
    interaction.on('scaling', function (e){
      $('#scaleinfo').text("scale: "+e.scale[0].toFixed(2)+","+e.scale[1].toFixed(2)); 
      if (firstPoint) {
        interaction.setCenter(e.features.getArray()[0].getGeometry().getFirstCoordinate());
      }
      if (e.features.getLength() === 1) {
        var feature = e.features.item(0);
        feature.set('radius', startRadius * Math.abs(e.scale[0]));
      }
    });
    // interaction.on(['rotateend', 'translateend', 'scaleend'], function (e) {
    //   $('#info').text(""); 
    // });
    </script>
</body>
</html>